{%- assign featured_product = null -%}

{%- capture content_for_querystring -%}
  {{ content_for_header }}
{%- endcapture -%}

{%- assign page_url = content_for_querystring
  | split: '"pageurl":"'
  | last
  | split: '"'
  | first
  | split: '.myshopify.com'
  | last
  | replace: '\/', '/'
  | replace: '%20', ' '
  | replace: '\u0026', '&'
-%}

{%- assign querystring = page_url | split: '?' | last -%}
{%- assign sort_by_param = querystring
  | split: 'sort_by='
  | last
  | split: '&'
  | first
-%}

{% if template contains 'collection' and sort_by_param != page_url %}
  {%- assign product_handle = sort_by_param -%}
  
  {%- for item in items -%}
    {%- if item.handle == product_handle -%}
      {%- assign featured_product = item -%}
    {%- endif -%}
  {%- endfor -%}
{% endif %}

{% comment %} another way {% endcomment %}
{% comment %} {%- capture contentForQuerystring -%}
  {{ content_for_header }}
{%- endcapture -%}
{%- assign pageUrl = contentForQuerystring
| split: '"pageurl":"'
| last
| split: '"'
| first
| split: request.host
| last
| replace: '\/', '/'
| replace: '%20', ' '
| replace: '\u0026', '&'
-%} {% endcomment %}
 