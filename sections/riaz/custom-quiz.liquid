{% comment %} 
  It's a custom quiz that collect the options and redirect matched product page.

  Features:
  ========
  - Easy to scale with more quiz data. 
  - Connect with Google sheet that store that quiz result.
  - Show the selected option to product page using localstorage
{% endcomment %}

{%- style -%}
  /* Common */
  #quizForm {
    width: 100%;
    height: auto;
    overflow-x: hidden;
    position: relative;
  }
  .screens-wrapper {
    display: flex;
    height: 100%;
    transition: transform 0.5s ease-in-out;
  }
  .screen {
    width: 100vw; /* Fix: use viewport width */
    flex-shrink: 0;
    height: 100%;
    padding: 20px 20px 0;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .screen-inner__wrapper {
    display: flex;
    flex-direction: column;
    text-align: center;
    width: 100%;
  }
  .ib_bold {
    display: inline-block;
    font-weight: 700;
  }
  .quiz-caption {
    font-size: 16px;
    font-weight: 400;
    margin-top: 0px;
    margin-bottom: 32px;
  }
  .quiz-main__title {
    font-size: 35px;
    line-height: 42px;
    margin-top: 0px;
    margin-bottom: 32px;
  }
  .quiz-main__description {
    font-size: 16px;
    font-weight: 400;
    line-height: 24px;
    margin-top: 0px;
    margin-bottom: 32px;
  }
  .quiz-btn__wrapper .quiz-caption {
    margin-bottom: 16px;
  }
  .screen-inner__wrapper .button {
    font-size: 16px;
    font-weight: 700;
    font-family: 'Archivo', sans-serif;
    border: 1px solid;
    border-radius: 8px;
    cursor: pointer;
    padding: 16px 40px;
    margin-top: 0px;
    line-height: 1;
    transition: all 0.3s ease-in-out;
  }
  .screen-inner__wrapper .button::before, 
  .screen-inner__wrapper .button::after {
    display: none;
  }
  .screen-inner__wrapper .button.button-primary {
    background-color: #000000;
    color: #ffffff;
  }
  .quiz-item__bottom {
    max-width: 850px;
    margin: 0 auto;
  }
  .hidden { display: none; }
  
  
  /* Screen 1 */
  .screen-single__top {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .screen-inner__wrapper .start-btn {
    background-color: #DBE7FF;
    border-color: #A3A3A3;
    color: #000000;
  }
  .screen-inner__wrapper .start-btn:hover {
    background-color: #000000;
    color: #ffffff;
  }
  
  img.get-started-image {
    width: 50%;
  }
  
  /* Screen two to last common */
  .quiz-item__header {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    padding-top: 40px;
  }
  .quiz-item__header .back {
    position: absolute;
    left: 0px;
    top: 5px;
    background-color: transparent;
    padding: 0px;
    border: none;
    cursor: pointer;
    margin: 0px;
  }
  .quiz-item__header .next {
    position: absolute;
    right: 15px;
    top: 5px;
    background-color: transparent;
    padding: 0px;
    border: none;
    cursor: pointer;
    margin: 0px;
    transform: rotate(180deg);
  }
  .quiz-item__nums {
    display: inline-block;
    font-size: 16px;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 32px;
  }
  .quiz-item__answer-group {
    display: grid;
    border: 1px solid transparent;
    gap: 20px;
    margin-bottom: 32px;
    padding-bottom: 10px;
  }
  .quiz-item__answer-group.quiz-item__image-btn {
    max-width: 510px;
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  .quiz-item__answer-group.quiz-item__text-btn {
    max-width: 500px;
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  .quiz-item__answer-box {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    position: relative;
    background-color: transparent;
    border: 0;
    border-radius: 0px;
    transition: background-color 0.5s;
  }
  .quiz-item__answer-box input {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    height: 100%;
    width: 100%;
    opacity: 0;
    display: block;
    cursor: pointer;
    z-index: 100;
    margin: 0px;
  }
  .quiz-item__checkmark {
    position: absolute;
    top: 12px;
    right: 12px;
    height: 24px;
    width: 24px;
    transform: scale(0);
    opacity: 0;
    transition: .5s cubic-bezier(.91,-.5,.21,1.35);
    z-index: 10;
  }
  .quiz-item__answer-box input:checked~.quiz-item__checkmark {
    opacity: 1;
    transform: scale(1);
  }
  .quiz-item__img {
    display: block;
    width: 100%;
    height: auto;
    object-fit: cover;
    margin-bottom: .5rem;
    border: 1px solid;
    border-radius: 8px;
    transition: .5s;
    aspect-ratio: 1.185;
  }
  .quiz-item__answer-box:hover .quiz-item__img {
    transform: scale(0.98);
  }
  .screen input:checked~.quiz-item__img {
    border-width: 2px;
    border-color: #000000;
  }
  
  /* Screen 2 */
  #screen2 .quiz-main__title {margin-bottom: 8px;}
  #screen2 .start-btn {
    margin-bottom: 25px;
  }
  
  /* Screen 4 */
  .quiz-item__answer-box.btn_type_primary {
    padding: 12px 30px 12px 16px;
    justify-content: center;
    border: 1px solid #A3A3A3;
    border-radius: 5px;
    background-color: #F9F7F3;
    transition: all 0.3s ease;
  }
  .quiz-item__answer-box.btn_type_primary .quiz-item__answer {
    font-size: 16px;
    color: #000000;
    line-height: 1;
    transition: all 0.3s ease;
  }
  .quiz-item__answer-box.btn_type_primary .quiz-item__checkmark {
    top: 50%;
    transform: translateY(-50%);
  }
  .quiz-item__answer-box.btn_type_primary input:checked ~ .quiz-item__checkmark {
    transform: translateY(-50%) scale(0.95);
  }
  .quiz-item__answer-box.btn_type_primary:hover {
    background-color: #000000;
  }
  .quiz-item__answer-box.btn_type_primary:hover .quiz-item__answer {
    color: #ffffff;
  }
  .quiz-item__bottom-image {
    display: block;
    width: 80%;
    margin-left: auto;
  }
  
  /* Screen 5 */
  #screen5 {
    height: 100vh; 
  }
  .klaviyo_form {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }
  
  input#klaviyoEmail {
    width: 260px;
    font-size: 14px;
    padding: 15px 15px;
    border: 1px solid #A3A3A3;
    border-radius: 8px;
  }
  
  .klaviyo_form .button {
    width: 260px;
    background-color: #000000;
    color: #ffffff;
  }
  .klaviyo-form button[type="button"] {
    margin-top: 10px;
  }
  
  #skipDiscountBtn {
    margin-top: 20px;
    font-size: 16px;
    color: #000000;
    padding: 0;
    background-color: transparent;
    border: 0;
    text-decoration: underline;
    cursor: pointer;
  }
  .quiz-item__success-message {
    width: 70%;
    margin: 0 auto;
  }
  
  .quiz-item__success-message img {
    max-width: 100%;
  }
  .quiz-item__success-message .giftbox-open {
    width: 80%;
  }
  .quiz-item__header-after {
    text-align: center;
  }
  .screen .store_logo {
    height: 16px;
    width: auto;
    margin-bottom: 80px;
  }
  
  .quiz-code {
    width: 250px;
    margin: 0 auto;
    padding: 15px;
    border: 1px dashed #A3A3A3;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  div#copyCodeSection .quiz-caption {
    margin-top: 20px;
  }
  
  /* Screen 6 */
  .circle-wrapper {
    position: relative;
    width: 130px;
    height: 130px;
    margin: auto;
  }
  .progress-ring {
    transform: rotate(-90deg);
  }
  .ring-bg {
    fill: none;
    stroke: transparent;
    stroke-width: 10;
  }
  .ring-progress {
    fill: none;
    stroke: #000000;
    stroke-width: 10;
    stroke-linecap: square;
    stroke-dasharray: 377; /* Circumference: 2Ï€r â‰ˆ 2*3.14*60 */
    stroke-dashoffset: 377; /* Start fully hidden */
    transition: stroke-dashoffset 0.3s linear;
  }
  .progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Archivo', sans-serif;
    font-weight: 700;
    font-size: 16px;
    color: #000000;
  }
  p.quiz-main__title {
    margin-top: 40px;
    margin-bottom: 0px;
  }
  
  /* Mobile */
  @media screen and (max-width: 767px) {
    /* Common */
    .quiz-item__header {
      padding-top: 12px;
    }
    .quiz-main__title {
      font-size: 24px;
      line-height: 1.3;
    }
    .quiz-item__bottom {
      width: 100%;
    }
    .quiz-item__answer-group.quiz-item__image-btn {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .quiz-item__answer-group.quiz-item__text-btn {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    .start-btn,
    .button.button-primary, 
    #skipDiscountBtn, 
    .btn, .quiz-code, input#klaviyoEmail {
      width: 90%;
    }
  
    /* Screen 1 */
    .screen-single__top {
      align-items: normal;
    }
    img.get-started-image {
      width: 85%;
    }
    .quiz-item__bottom-image {
      width: 73%;
    }
  
    /* screen 5 */
    #screen5 {
      height: 932px;
      max-height: 100vh; 
    }
    #screen5 .screen-inner__wrapper {
      height: 100%;
    }
    #screen5 .quiz-item__bottom {
      height: 100%;
      position: relative;
    }
    .screen .store_logo {
      margin-bottom: 80px;
    }
    .quiz-item__success-message {
      width: 100%;
    }
    .quiz-item__success-message .giftbox-open {
      width: 100%;
      position: relative;
      bottom: 0px;
    }

    /* screen 6 */
    #screen6 {
      padding-top: 52px;
    }
    p.quiz-main__title {
      font-family: 'Archivo', sans-serif;
      font-weight: 700;
      color: #000000;
      line-height: 1;
    }
  }


  /* Fixed height */
  {% if section.settings.hide_header_footer %}
    .shopify-section-group-header-group,
    .shopify-section-group-footer-group {
      display: none !important;
    }
    #quizForm {
      min-height: 100vh;
      background-color: #ffffff;
    }
    /* .screen-inner__wrapper {
      overflow-y: auto;
    } */
  
    @media screen and (max-width: 767px) {
      .quiz-item__success-message .giftbox-open {
        width: 70%;
        position: absolute;
        bottom: 0px;
        left: 50%;
        transform: translateX(-50%);
      }
    }
  {% endif %}
{%- endstyle -%}

<div class="section-{{ section.id }}">
  <form id="quizForm">
    <div class="screens-wrapper" id="screensWrapper">

      <!-- Screen 1 Get Starter -->
      <div class="screen" id="screen1">
        <div class="screen-inner__wrapper">
          <div class="screen-single__top">
            <p class="quiz-caption">No Guesswork. Backed by Results.</p>
            <h1 class="quiz-main__title">Find Your Perfect Skin Fix</h1>
            <p class="quiz-main__description">Just answer 3 questions. Weâ€™ll match you with the right concealing gel + <span class="ib_bold">give you 30% off to try.</span></p>
            <div class="quiz-btn__wrapper">
              <p class="quiz-caption">Got 30 seconds?</p>
              <button type="button" class="button start-btn" onclick="goToScreen(1)">Let's Start</button>
            </div>
          </div>
          <div class="quiz-item__bottom">
            <img class="get-started-image" src="https://cdn.shopify.com/s/files/1/0646/9002/8680/files/Toilettas_Black_Alpha_Skin.png?v=1748744996" width="auto" height="auto" alt="Get Started">
          </div>
        </div>
      </div>

      <!-- Screen 2 - First options -->
      <div class="screen" id="screen2">
        <div class="screen-inner__wrapper">
          <div class="quiz-item__header">
            <button type="button" class="back" onclick="goToScreen(0)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="next next2 hidden" onclick="goToScreen(2)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="quiz-item__container">
              <span class="quiz-item__nums">1 of 3</span>
              <h2 class="quiz-main__title">What is your main concern?</h2>
              <p class="quiz-main__description">You can select multiple</p>
            </div>
          </div>
          <div class="quiz-item__bottom">
            <fieldset class="options quiz-item__answer-group quiz-item__image-btn">
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="acne_blemishes_main_concern">
                <input type="checkbox" id="acne_blemishes_main_concern" name="Main_Concern[]" value="Acne / Blemishes">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/oily_breakouts_1.png?v=1749073325" width="auto" height="auto" alt="Quiz item placeholder" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Acne / Blemishes</div>
              </label>

              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="dark_circles_main_concern">
                <input type="checkbox" id="dark_circles_main_concern" name="Main_Concern[]" value="Dark Circles">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/darkcircle_1.png?v=1749074067" width="auto" height="auto" alt="Quiz item placeholder" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Dark Circles</div>
              </label>

              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="pigmentation_main_concern">
                <input type="checkbox" id="pigmentation_main_concern" name="Main_Concern[]" value="Pigmentation">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/Pigmentation-skin.png?v=1749073325" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Pigmentation</div>
              </label>

              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="general_dullness_main_concern">
                <input type="checkbox" id="general_dullness_main_concern" name="Main_Concern[]" value="General Dullness">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/general_dullness.png?v=1749073325" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">General Dullness</div>
              </label>

              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="scars_main_concern">
                <input type="checkbox" id="scars_main_concern" name="Main_Concern[]" value="Scars">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/acnescars_1.png?v=1749073325" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Scars</div>
              </label>

              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="red_skin_main_concern">
                <input type="checkbox" id="red_skin_main_concern" name="Main_Concern[]" value="Red Skin">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/Red_Skin.png?v=1749073325" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Red Skin</div>
              </label>

            </fieldset>
            <button type="button" class="button start-btn hidden next2" id="next2" onclick="goToScreen(2)">Next Question</button>
            <div class="quiz-item__bottom-caption">Hide it like it was never there.</div>
          </div>
        </div>
      </div>

      <!-- Screen 3 - Second options -->
      <div class="screen" id="screen3">
        <div class="screen-inner__wrapper">
          <div class="quiz-item__header">
            <button type="button" class="back" onclick="goToScreen(1)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="next hidden" id="next3" onclick="goToScreen(3)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="quiz-item__container">
              <span class="quiz-item__nums">2 of 3</span>
              <h2 class="quiz-main__title">Which resembles your skin best?</h2>
              <!-- <p class="quiz-main__description">You can select multiple</p> -->
            </div>
          </div>
          <div class="quiz-item__bottom">
            <fieldset class="options quiz-item__answer-group quiz-item__image-btn">
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_light">
                <input type="radio" id="which_resembles_light" name="Which_Resembles[]" value="Light" data-value="1">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/light.png?v=1749074549" width="auto" height="auto" alt="Quiz item placeholder" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Light</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_light_medium">
                <input type="radio" id="which_resembles_light_medium" name="Which_Resembles[]" value="Light / Medium" data-value="1">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/light_-_medium_046af4e2-fea0-4621-b2be-4054a2add217.png?v=1749074549" width="auto" height="auto" alt="Quiz item placeholder" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Light / Medium</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_medium_fair">
                <input type="radio" id="which_resembles_medium_fair" name="Which_Resembles[]" value="Medium / Fair" data-value="1">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/medium_-_fair.png?v=1749074549" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Medium / Fair</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_medium">
                <input type="radio" id="which_resembles_medium" name="Which_Resembles[]" value="Medium" data-value="2">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/medium.png?v=1749074549" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Medium</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_medium_dark">
                <input type="radio" id="which_resembles_medium_dark" name="Which_Resembles[]" value="Medium / Dark" data-value="2">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/medium_-_dark.png?v=1749074549" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Medium / Dark</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_secondary" for="which_resembles_dark">
                <input type="radio" id="which_resembles_dark" name="Which_Resembles[]" value="Dark" data-value="2">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <img src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/dark.png?v=1749074549" alt="Quiz item placeholder" width="52" height="52" class="quiz-item__img" loading="lazy">
                <div class="quiz-item__answer">Dark</div>
              </label>
            </fieldset>
            <div class="quiz-item__bottom-caption">Your shade, no guesswork.</div>
          </div>
        </div>
      </div>

      <!-- Screen 4 - Third options -->
      <div class="screen" id="screen4">
        <div class="screen-inner__wrapper">
          <div class="quiz-item__header">
            <button type="button" class="back" onclick="goToScreen(2)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="next hidden" id="next4" onclick="goToScreen(4)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="quiz-item__container">
              <span class="quiz-item__nums">3 of 3</span>
              <h2 class="quiz-main__title">How important is it to fix this skin issue right now?</h2>
            </div>
          </div>
          <div class="quiz-item__bottom">
            <fieldset class="options quiz-item__answer-group quiz-item__text-btn">
              <label class="quiz-item__answer-box quiz-item__btn btn_type_primary" for="how_important_very">
                <input type="radio" id="how_important_very" name="How_Important[]" value="Very â€” I want a fast, effective fix">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="quiz-item__answer">Very â€” I want a fast, effective fix</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_primary" for="how_important_important">
                <input type="radio" id="how_important_important" name="How_Important[]" value="Important, Iâ€™m exploring options">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="quiz-item__answer">Important, Iâ€™m exploring options</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_primary" for="how_important_curious">
                <input type="radio" id="how_important_curious" name="How_Important[]" value="Just curious - checking whatâ€™s there">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="quiz-item__answer">Just curious - checking whatâ€™s there</div>
              </label>
    
              <label class="quiz-item__answer-box quiz-item__btn btn_type_primary" for="how_important_not_sure">
                <input type="radio" id="how_important_not_sure" name="How_Important[]" value="Not Sure">
                <svg class="quiz-item__checkmark icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="11" fill="#DBE7FF" stroke="black" stroke-width="2"/>
                  <path d="M6.60461 12L10.2016 15.597L17.3954 8.40308" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="quiz-item__answer">Not sure</div>
              </label>
    
            </fieldset>
            <div class="quiz-item__bottom-caption">Fast fix, zero fuss.</div>
            <img class="quiz-item__bottom-image" src="https://cdn.shopify.com/s/files/1/0790/5974/7140/files/screen4-bottom-image.png?v=1749070893" width="auto" height="auto" alt="">
          </div>
        </div>
      </div>

      <!-- Screen 5 - klaviyo and submit buttons -->
      <div class="screen" id="screen5">
        <div class="screen-inner__wrapper">
          <div class="quiz-item__header">
            <div class="quiz-item__header-before">
              <button type="button" class="back" onclick="goToScreen(3)">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="13" viewBox="0 0 18 13" fill="none">
                  <path d="M1.43597 6.08189H16.5588" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M6.47694 11.1228L1.436 6.0819L6.47694 1.04095" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg> 
              </button>
              <!-- No next button, since it's the last screen that can user go and back. -->
              <div class="quiz-item__container">
                <span class="quiz-item__nums">Bonus</span>
                <h2 class="quiz-main__title">Enter email to get 10% discount code + get your results</h2>
              </div>
            </div>
            <div class="quiz-item__header-after hidden">
              <img src="https://cdn.shopify.com/s/files/1/0646/9002/8680/files/store-logo.png?v=1748764116" width="auto" height="auto" alt="store logo" class="store_logo">
              <h2 class="quiz-main__title">Your 10% discount is ready ðŸŽ‰</h2>
            </div>
          </div>
          <div class="quiz-item__bottom">
            <div id="klaviyoSection">
              <!-- <div class="klaviyo_form">
                <input type="email" placeholder="Enter your email" id="klaviyoEmail" />
                <button type="button" class="button button-primary" onclick="claimDiscount()">Claim Discount</button>
              </div> -->
              <div class="klaviyo-form-TqSma7"></div>
              <button type="button" id="skipDiscountBtn" class="btn" onclick="submitForm()">Get result without discount</button>
            </div>
            <div id="copyCodeSection" class="hidden">
              <div class="quiz-code">JK283K</div>
              <button type="button" id="copyAndGetResultBtn" class="button button-primary" onclick="copyCodeAndSubmit()">Copy code and get Result</button>
              <div class="quiz-caption">Your discount will be automatically applied in the checkout.</div>
            </div>
            <div class="quiz-item__success-message">
              <img class="giftbox-box" src="https://cdn.shopify.com/s/files/1/0646/9002/8680/files/giftbox-box.png?v=1748750025" width="auto" height="auto" alt="">
              <img class="giftbox-open hidden" src="https://cdn.shopify.com/s/files/1/0646/9002/8680/files/giftbox-open.png?v=1748750024" width="auto" height="auto" alt="">
            </div>
          </div>
        </div>
      </div>

      <!-- Screen 6 (Loading) -->
      <div class="screen" id="screen6">
        <div class="screen-inner__wrapper">
          <div class="quiz-item__header">
            <img src="https://cdn.shopify.com/s/files/1/0646/9002/8680/files/store-logo.png?v=1748764116" width="auto" height="auto" alt="" class="store_logo">
            <div class="circle-wrapper">
              <svg class="progress-ring" width="130" height="130">
                <circle class="ring-bg" cx="65" cy="65" r="60" />
                <circle class="ring-progress" cx="65" cy="65" r="60" />
              </svg>
              <div class="progress-text" id="progressText">0%</div>
            </div>
            <p class="quiz-main__title">Finding the best solution tailored for you!</p>
          </div>
        </div>
      </div>
                  
    </div>
  </form>
</div>

<script>
  // API given by google sheet app 
  const scriptURL = 'https://script.google.com/macros/s/AKfycbx5v4ccXEDoOzIGVSxv4gSg-HjfbXIHRNo3ubm3F4uqoKUH9X4sC476INTdswcDNVntpA/exec';

  // On DOM load, set wrapper width based on child count
  window.addEventListener('DOMContentLoaded', () => {
    const wrapper = document.getElementById("screensWrapper");
    const screens = wrapper.querySelectorAll(".screen");
    wrapper.style.width = `${screens.length * 100}vw`; // width in vw
  });
  
  let currentScreen = 0;
  
  // Scroll to the top of the page
  function goToScreen(index) {
    window.scrollTo(0, 0);
    
    const wrapper = document.getElementById("screensWrapper");
    let delay = 0;
    if (index == 1) {
      const allCheckboxes = document.querySelectorAll('#screensWrapper input[type="checkbox"]');
      allCheckboxes.forEach(cb => cb.checked = false);
    }
    if (index > 2) delay = 400;
  
    setTimeout(() => {
      wrapper.style.transform = `translateX(-${index * 100}vw)`;
      currentScreen = index;
    }, delay);
  }
  
  document.querySelectorAll('#screen2 input[type="checkbox"]').forEach(input => {
    input.addEventListener('change', () => {
      const anyChecked = Array.from(document.querySelectorAll('#screen2 input[type="checkbox"]')).some(cb => cb.checked);
      document.getElementById("next2").classList.toggle("hidden", !anyChecked);
      document.querySelector('#screen2 .next').classList.toggle('hidden', !anyChecked);
    });
  });
  
  document.querySelectorAll('#screen3 input[type="radio"]').forEach(input => {
    input.addEventListener('change', () => {
      document.getElementById('next3').classList.remove('hidden');
      goToScreen(3);
    });
  });
  
  document.querySelectorAll('#screen4 input[type="radio"]').forEach(input => {
    input.addEventListener('change', () => {
      document.getElementById('next4').classList.remove('hidden');
      goToScreen(4);
      let klaviyoBtn = document.querySelector('.klaviyo-form button[type="button"');
      if(klaviyoBtn) klaviyoBtn.addEventListener('click', claimDiscount);
    });
  });
  
  function claimDiscount() {
    document.querySelector(".quiz-item__header-before").classList.add("hidden");
    document.querySelector(".quiz-item__header-after").classList.remove("hidden");
    document.getElementById("klaviyoSection").classList.add("hidden");
    document.getElementById("copyCodeSection").classList.remove("hidden");
    document.querySelector(".giftbox-box").classList.add("hidden");
    document.querySelector(".giftbox-open").classList.remove("hidden");
  }
  
  function copyCodeAndSubmit() {
    navigator.clipboard.writeText("JK283K").then(() => {
      submitForm();
    });
  }
  
  // Common function to store selections
  function storeScreen2Selections() {
    const screen2Checkboxes = document.querySelectorAll('#screen2 input[type="checkbox"]');
    const selected = Array.from(screen2Checkboxes)
      .filter(cb => cb.checked)
      .map(cb => cb.value);
    localStorage.setItem("screen2Selections", JSON.stringify(selected));
  }
  
  function progressLoading(redirect) {
    let percent = 0;
    let dataValue = document.querySelector("#screen3 input:checked").getAttribute('data-value');
    const text = document.getElementById("progressText");
    const ring = document.querySelector(".ring-progress");
    const radius = 60;
    const circumference = 2 * Math.PI * radius;

    // Reset checkboxes manually
    const allRadios = document.querySelectorAll('#screensWrapper input[type="radio"]');
    allRadios.forEach(r => r.checked = false);
  
    const interval = setInterval(() => {
      percent += 2;
      if (percent > 100) percent = 100;
  
      const offset = circumference - (percent / 100) * circumference;
      ring.style.strokeDashoffset = offset;
      text.textContent = percent + "%";
  
      if (percent >= 100 && redirect) {
        clearInterval(interval);
        storeScreen2Selections();
  
        if (dataValue == 1) {
          window.location.href = 'https://alphaskin.nl/en/pages/find-your-perfect-skin-fix-light-version';
        }
        else {
          window.location.href = 'https://alphaskin.nl/en/pages/find-your-perfect-skin-fix-medium-version';
        }
      }
    }, 60);
  }

  function submitForm() { 
    let redirect = false;
  
    // 1ï¸âƒ£ Gather quiz data
    const screen2Selections = Array.from(document.querySelectorAll('#screen2 input[type="checkbox"]:checked'))
      .map(cb => cb.value).join(', ');
  
    const screen3Selection = document.querySelector('#screen3 input[type="radio"]:checked')?.value || '';
    const screen4Selection = document.querySelector('#screen4 input[type="radio"]:checked')?.value || '';
  
    const claimedDiscount = !document.querySelector(".quiz-item__header-after")?.classList.contains("hidden");
    const discountCode = claimedDiscount ? "JK283K" : "Not Claimed";
  
    const quizData = new FormData();
    quizData.append("Question 1", screen2Selections);
    quizData.append("Question 2", screen3Selection);
    quizData.append("Question 3", screen4Selection);
    quizData.append("Discount Claimed", claimedDiscount ? "Yes" : "No");
    quizData.append("Discount Code", discountCode);

    goToScreen(5); // Show loading screen
  
    // 2ï¸âƒ£ Submit to Google Sheet
    fetch(scriptURL, {
      method: 'POST',
      mode: 'cors',
      body: quizData
    })
    .then(response => {
      console.log("Quiz data submitted!");
    })
    .catch(error => {
      console.error("Error submitting quiz data!", error.message);
    });
  
    redirect = true;
    progressLoading(redirect);
  }
</script>

{% comment %} 
  Code for product page: 
{% endcomment %}

<style>
  /* Landing page */
  #screen2-selected-option {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
  .selected-option {
    display: inline-block;
    padding: 5px 20px;
    border: 1px solid #ffffff;
    border-radius: 50px;
  }
</style>

<div id="screen2-selected-option"></div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  // On any future screen, show selections
  const displayContainer = document.getElementById("screen2-selected-option");
  if (displayContainer) {
    const stored = localStorage.getItem("screen2Selections");
    if (stored) {
      const selectedItems = JSON.parse(stored);
      if (selectedItems.length > 0) {
        displayContainer.innerHTML = selectedItems
          .map(item => `<span class="selected-option">${item}</span>`)
          .join("");
      }
    }
  }
});
</script>


{% schema %}
  {
    "name": "Latern Quiz",
    "settings": [
      {
        "type": "checkbox",
        "id": "hide_header_footer",
        "label": "Hide Header Footer",
        "default": true
      }
    ],
    "presets": [
      {
        "name": "Latern Quiz"
      }
    ]
  }
{% endschema %}