{% comment %} 
  It's kind of snippet code for a Shopify theme that displays upsell products in a cart drawer. 
  The code includes a swiper slider to showcase products that are not already in the cart, with options to add them directly to the cart. 
  The design is responsive and includes loading animations for better user experience. 
  The upsell products are fetched from a specified collection and displayed with their images, titles, and prices.
  The code also includes navigation buttons for the swiper slider and a scrollbar for better navigation through the products.
  This is a custom implementation that can be used in Shopify themes to enhance the cart experience by suggesting additional products to customers.
  - Custom Cart Upsell Section

  Prerequisites:
  - Ensure you have a collection set up in your Cart drawer section settings that contains the upsell products
  - Ensure you have the Swiper library included in your theme for the slider functionality
  - Ensure you have the necessary CSS styles for the swiper and product display
  - Ensure you have the loader styles and scripts included in your theme for the loading animations
  - Ensure you have the necessary JavaScript to handle custom tag define (custom-cart-upsell) and the add-to-cart functionality and update the cart drawer dynamically
{% endcomment %}

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>
{{ 'cart-upsell.css' | asset_url | stylesheet_tag }}

<script 
  src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" 
  defer="defer"
></script>
<script 
  src="{{ 'cart-upsell.js' | asset_url }}"
  defer="defer"
></script>


{% assign section = section.settings %}
{% assign collection = section.settings.collection %}

{% if collection == blank %}
  {% assign collection = collections[section.settings.collection_handle] %}
{% endif %}

{% if collection == blank %}
  {% assign collection = collections['upsell-products'] %}
{% endif %}

{% if collection == blank %}
  {% assign collection = collections['default-collection'] %}
{% endif %}

{% if section.settings.heading == blank %}
  {% assign section.settings.heading = 'You may also like' %}
{% endif %}

<custom-cart-upsell class="custom-cart-upsell cart-upsell__slider-wrapper" id="{{ section.id }}">
  {% if section.settings.collection %}
  {% assign shown = 0 %}
  <div class="swiper mySwiper cart-upsell__slider">
    <div class="cart-upsell__slider-header">
      <h2 class="font-base">{{ section.settings.heading }}</h2>
    </div>
    <div class="swiper-wrapper">
      {% for upsell_product in section.settings.collection.products %}
        {%- comment -%} skip products already in cart {%- endcomment -%}
        {% assign in_cart = false %}
        {% for item in cart.items %}
          {% if item.product_id == upsell_product.id %}
            {% assign in_cart = true %}
            {% break %}
          {% endif %}
        {% endfor %}

        {% if in_cart %}
          {% continue %}
        {% endif %}

        {%- comment -%} stop when reached limit {%- endcomment -%}
        {% if shown >= section.settings.limit %}
          {% break %}
        {% endif %}

        {% assign shown = shown | plus: 1 %}

        <div class="swiper-slide cart-upsell__slide">
          <div class="cart-upsell__slide-wrapper">
            <div class="cart-upsell__slide-inner has__spinner">
              <div class="loading-overlay loader-hidden">
                <div class="loading-overlay__spinner">
                  <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                  </svg>
                </div>
              </div>
              <div class="cart-upsell__slide-media">
                <a href="{{ upsell_product.url }}" class="d-block w-100">
                  {% if upsell_product.featured_image %}
                  <img src="{{ upsell_product.featured_image | image_url: width: 400 }}"
                    alt="{{ upsell_product.title | escape }}" width="auto" height="auto">
                  {% endif %}
                </a>
                <button class="plus-icon" data-add-to-cart
                  data-variant-id="{{ upsell_product.selected_or_first_available_variant.id }}"
                  data-product-handle="{{ upsell_product.handle }}">
                  <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="8.5" y1="1" x2="8.5" y2="14" stroke="#231C19" />
                    <line x1="2" y1="7.5" x2="15" y2="7.5" stroke="#231C19" />
                  </svg>
                </button>
              </div>
              <div class="cart-upsell__slide-content">
                <h4 class="font-small">{{ upsell_product.title | truncate: 15 }}</h4>
                <div class="sd-slide__price">
                  <span class="cart-upsell__slide--price">
                    {{ upsell_product.price | money }}
                  </span>
                  {% if upsell_product.compare_at_price > upsell_product.price %}
                  <span class="cart-upsell__slide-regular-price">
                    {{ upsell_product.compare_at_price | money }}
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="swiper-button-next">
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="4.83594" y="1" width="9.4562" height="1.18202" transform="rotate(45 4.83594 1)" fill="#231C19" />
        <rect x="4" y="13.5371" width="9.4562" height="1.18202" transform="rotate(-45 4 13.5371)" fill="#231C19" />
      </svg>
    </div>
    <div class="swiper-button-prev">
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g>
          <rect x="10.6865" y="14.3729" width="9.45619" height="1.18202" transform="rotate(-135 10.6865 14.3729)"
            fill="#231C19" />
          <rect x="11.5225" y="1.83582" width="9.45619" height="1.18202" transform="rotate(135 11.5225 1.83582)"
            fill="#231C19" />
        </g>
      </svg>
    </div>
    <div class="swiper-scrollbar__wrapper">
      <div class="swiper-scrollbar cart-upsell__scrollbar"></div>
    </div>
  </div>
  {% endif %}
</custom-cart-upsell>

